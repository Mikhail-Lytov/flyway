# Настройка сервиса

Данный код предназначен для миграций данных, следует применять следующие правила:

- Внесения любых справочных данных должны быть прописаны в миграциях
- Внесения правок в модель должны быть через миграцию
- запрещается удалять любые справочные данные без внесения в миграцию
- запрещается править содержимое таблицы `flyway_schema_history`

При включенной миграции, структура базы данных и наполнения справочников будут созданы автоматически

Для запуска необходима только наличие пользователей(можно включить в миграцию) и наличие схемы (тоже возможно внести в миграцию)
## DDL
Конфигурация ddl может быть следующих типов

- `create`: Создайте схему базы данных при запуске приложения. (При создании будет удалена старая версия)
- `create-drop`: Создайте схему базы данных при запуске приложения и удалите ее при завершении работы приложения.
- `update`: Обновляйте схему базы данных при внесении изменений в свои объекты.
- `validate`: Проверьте соответствие схемы базы данных метаданным
- `none`: отключение функции

Для использования в тест и прод контуре рекомендуется использовать validate.

При несоотвествии бд и модели, приложение не будет запущено.

## Миграция

### Настройка 
- `flyway: baseline-on-migrate`: Эта опция заставляет Flyway создать базовый образ  (baseline) вашей базы данных при выполнении миграции. Базовый образ - это  "снимок" состояния базы данных,  с которого Flyway начинает  контролировать  изменения. Это полезно, если вы уже работаете с  базой данных и не хотите  менять ее существующие  таблицы и данные.
- `flyway: validate-on-migrate`: Эта опция заставляет Flyway  проверять  все  файлы  миграции перед их  выполнением.  Она  убеждается,  что  файлы миграции  написаны  правильно и что  они  не  будут  вызывать  ошибок  при  выполнении. 
- `flyway: enabled`: Эта опция  включает  Flyway.  Если  она  установлена  в false, Flyway  не  будет  выполняться.
- `flyway:  validate-migration-naming`: Эта опция  отключает  проверку  имен  файлов миграции.  По  умолчанию Flyway  требует, чтобы  имена  файлов  миграции  были  в  формате V[номер миграции]__[Описание миграции].  Отключение  этой  опции  позволяет  использовать  иные  форматы  имен  файлов  миграции.

### Патерн наименования файла

`--<Prefix<code>><</code>Version>__<code><</code>Description>.sql`

Где:

- `<Prefix>` — префикс. Для версионных миграций по умолчанию равен “V”. Префикс настраивается через свойство flyway.sqlMigrationPrefix.
- `<Version>` — номер версии миграции. Мажорную и минорную версии можно разделить подчеркиванием. Версия всегда должна начинаться с 1.
- `<Description>` — текстовое описание миграции. Описание должно быть отделено от номера версии двумя подчеркиваниями.

#### Пример
V1_0_0__initial_db.sql


## Настройка миграции
Есть возможность переноса части миграции
- db/migration/base_img_bd - базовый дамп справочников и структуры бд
- db/migration/script - скрипты миграции